{% extends "header.html" %}

{% block title %}
    <title>
        GraphPage
    </title>
{% endblock %}
{% block content %}
    <div class='MainFuncDiv'>
        <h1 align="center">
            Расчёты произведены. Выберите необходимую опцию:
        </h1>
        <div class='FuncDiv'>
            <div class='ButtonDiv'>
                {% for i in buttons.name %}
                    <div style="padding: 3px; width: 25vw;">
                        <a href="{% url 'testview' i.2 %}">
                            <button class={{ i.1 }},
                                    style='padding: 3px; height: 6vh; width: 25vw; font-size: 20px;'>
                                {{ i.0 }}
                            </button>
                        </a>
                    </div>
                {% endfor %}
            </div>

            <div class='PlotAndInputDiv'>
                <p style="font-size: 20px; text-align: center; margin-bottom: 5px; margin-top: 10px">
                    {{ header }}
                </p>
                {% if condition == 1 %}
                    <form class="InputForm" action="" method="POST">
                        {% csrf_token %}
                        <div class="InputDiv">
                            <input name="patientPC" class="ValuesInput" type="text" style="width: 20vh; height: 20px">
                            <button class="SubmitButton" type="submit" style="height: 26px">Ok</button>
                        </div>
                    </form>
                    <p style="height: 2vh; text-align: center;">
                        {{ data }}
                    </p>
                    <div class="PlotDiv">
                        <div class="Plot" id="myPlot"></div>
                        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
                        <script>
                            var x_y_data = JSON.parse("{{x_y_data|escapejs}}");
                            var data = [];
                            for (var x in x_y_data) {
                                var xArray = x_y_data[x][0];
                                var yArray = x_y_data[x][1];
                                var temp = {
                                    x: xArray,
                                    y: yArray,
                                    mode: "markers",
                                    type: 'scatter',
                                    name: x
                                };
                                data.push(temp);
                            }

                            // Define Layout
                            var layout = {
                                xaxis: {title: "PC{{ data.0 }}"},
                                yaxis: {title: "PC{{ data.1 }}"},
                                title: "Graph in PC{{ data.0 }}-PC{{ data.1 }} coordinates",
                                width: 1200,
                                height: 370,
                            };

                            // Display using Plotly
                            Plotly.newPlot("myPlot", data, layout);
                        </script>
                    </div>
                    </div>
                {% elif condition == 0 %}
                    <div class="Plot" id="myPlot"></div>
                    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
                    <script>
                        var x_y_data = JSON.parse("{{x_y_data|escapejs}}");
                        var data = [];
                        for (var x in x_y_data) {
                            var xArray = x_y_data[x][0];
                            var yArray = x_y_data[x][1];
                            var temp = {
                                x: xArray,
                                y: yArray,
                                mode: "markers",
                                type: 'scatter',
                                name: x
                            };
                            data.push(temp);
                        }

                        // Define Layout
                        var layout = {
                            xaxis: {title: "PC1"},
                            yaxis: {title: "PC2"},
                            title: "Graph in PC1-PC2 coordinates"
                        };


                        // Display using Plotly
                        Plotly.newPlot("myPlot", data, layout);
                    </script>
                {% endif %}
        </div>
    </div>
{% endblock %}
{% block style %}
    <style>
        .MainFuncDiv {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .FuncDiv {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            border: solid black 1px;
        }

        .ButtonDiv {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            border: solid black 1px;
            padding: 7vh 1%;
            height: 40vh;
        }

        .PlotAndInputDiv {
            display: flex;
            flex-direction: column;
        }

        .InputForm {
            margin: 0 auto;
        }

        .PlotDiv {
            width: 70vw;
            height: 40vh;
        }

        .InputDiv {
        }

    </style>

{% endblock %}
